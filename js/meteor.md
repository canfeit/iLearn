## 目录约定

- lib 下的代码最先加载
- server 存放服务端代码
- client 存放客户端代码（html/css/js）
- public 下存放图片、字体
- lib 目录里的文件最先加载
- 子目录里的文件优先加载
- 文件名匹配 main.\* 的文件优先加载
- 在一个目录中按照文件名的字母顺序加载
- client 和 public 目录以外的 JavaScript 加载到 Node.js
- server 和 public 目录以外的 JavaScript 压缩发送给客户端
- tests 目录内的文件不会加载到任何地方
- client、server、public 和 tests 以外的 js，在客户端和服务器端两边都会被加载，用于定义模型和其他函数。Meteor 提供了两个变量 isClient 和 isServer，这样你的代码可以根据他们是运行在客户端还是服务器来改变行为。
- server 和 public 以外的 CSS 文件会被集中在一起：客户端会得到一个含有你的目录树下的所有 CSS 文件的“捆绑”

## 启动

1. meteor 启动，客户端生成默认空主页只加载了 package,接着 client 中的文件按加载规则整合进主页，ReactLayout.render 在页面最后
2. Meteor 扫描你目录内所有 HTML 文件中的 3 个顶层元素：<head>,<body>,和<template>。head 和 body 区会分别包含到初始载入页面的 head 和 body 中，并发送给客户端。
   template 区则会被转换成 Template 命名空间下的 JavaScript 函数。这是一个将 HTML 传递给客户端的非常方便的方式。

## 数据

在 Meteor 中，客户端和服务器共享相同的数据库 API。完全相同的应用程序代码——例如校验器和计算好的属性——常常能在两个地方运行。但是代码在服务器上运行时，是直接访问数据库，而在客户端则不是。这个差异是 Meteor 的数据安全模式的基础。

## 安全

一个新的 Meteor 应用默认包含了 autopublic 和 insecure 包，它们模拟客户端拥有对服务器数据库的完全读/写能力。这是个有用的原型工具，但是对于发布级产品并不合适。你在发布之前应该删除这两个包。

## 原理

- 每个 Meteor 客户端都包含一份保留在内存中的数据库缓存。服务器发布 JSON 文档集合(sets of JSON documents)，客户端订阅这些文档集合，以管理客户端的缓存。当集合中的文档发生变化时，服务器发送“补丁”给每个客户端缓存。
- 每个文档集合都由客户端上的“发布”函数(publish function)定义。每当有一个新的客户端订阅文档集合时就执行“发布”函数。文档集合中的数据可以来自任何地方，但是最常见的情况是发布(publish)一个数据库查询。
- 一旦订阅，客户端使用它的缓存就像高速本地数据库一样，代码简单得出奇。读取时从来不需要在服务器的往返之间消耗。缓存中的内容会被限制：在客户端查询表(collection)中的文档时，只有服务器发布给客户端的文档会被返回。
- 完备的客户端能开启或关闭订阅，以控制如何保持缓存和管理网络流量。当一个订阅被关闭，它的所有文档都会从缓存中删除，除非另一个激活的订阅提供了相同的文档。
- 当客户端改变了一个或多个文档，它会发送一个消息到服务器来请求这个改动。服务器通过一个你以 JavaScript 函数形式写的允许/拒绝规则集，来检查这个改变提议。只有当所有规则都通过时，服务器才接受改变。
- 如果服务器接受改变，就会讲变化应用到数据库，并且自动将改变散布给其他订阅了受影响文档的客户端。如果不接受，更新操作失败，服务器上的数据库不变，也没有其他客户端会看到更新。
- Meteor 有个聪明的机制。当客户端提议写入服务器，它就会立刻更新自己的本地缓存，不需要等待服务器的回应。这意味着屏幕会立刻重绘。如果服务器接受改变——在行为合理的客户端中大部分情况下都会如此——客户端更新屏幕不需要等待服务器。如果服务器拒绝改变，Metero 用服务器的结果来修正客户端的缓存。
- Meteor 包含了 Meteor 账户，一个文艺范儿的认证系统。主要体现在登陆密码所使用远程安全密码协议(Secure Remote Password protocol)，外部服务整合，包括 Facebook，GitHub，Google，Twitter，还有新浪微博。Meteor 账户定义了一个名为 Meteor.users 的表(collection)，开发者可以在里面存放一些应用程序特定的用户数据。
- Meteor 还为一些通常的任务预建了表单，例如登陆，注册，修改密码，用邮箱来修改密码。你能用一行代码就添加一个账户界面到你的应用中。账户界面甚至还明智地打包了一个配置向导，来引导你在你的应用里安装外部登陆服务。
- Meteor 拥抱无功编程(reactive programming)的概念。这意味着，你可以以简单的命令风格写代码，然后结果自动重新计算当你的代码依赖的数据变化时。
- 默认情况下，一个新的 Meteor 应用包含 autopublish 和 insecure 包，它们能够模拟每个客户机对服务器上的数据库拥有完全读写权限的效果。 它们是非常有用的原型工具，但通常不适用于生产环境中。当你准备发布程序时，请移除这两个包。
